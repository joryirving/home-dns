include "/etc/bind/rndc.sops.key";
include "/etc/bind/kubernetes-main.sops.key";
include "/etc/bind/kubernetes-utility.sops.key";

controls {
    inet 127.0.0.1 allow { 127.0.0.1; } keys { "rndc-key"; };
};

acl internal {
    10.0.0.0/8;
    172.16.0.0/12;
    192.168.0.0/16;
};

options {
    listen-on port 53 { any; };
    directory "/var/cache/bind";
    allow-recursion { internal; };
    allow-transfer { none; };
    allow-update { none; };
    dnssec-validation no;
};

zone "jory.dev." {
    type master;
    file "/etc/bind/zones/jory.dev.zone";
    journal "/var/cache/bind/jory.dev.zone.jnl";
    allow-transfer { key "kubernetes-main-key"; };
    update-policy { grant kubernetes-main-key zonesub ANY; };
};

zone "j8g.dev." {
    type master;
    file "/etc/bind/zones/j8g.dev.zone";
    journal "/var/cache/bind/j8g.dev.zone.jnl";
    allow-transfer { key "kubernetes-utility-key"; };
    update-policy { grant kubernetes-utility-key zonesub ANY; };
};

zone "jory.casa." {
    type master;
    file "/etc/bind/zones/jory.casa.zone";
    journal "/var/cache/bind/jory.casa.zone.jnl";
};

zone "internal." {
    type forward;
    forward only;
    forwarders { 192.168.1.1; };
};
