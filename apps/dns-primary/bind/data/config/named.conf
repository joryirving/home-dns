include "/etc/bind/rndc.sops.key";
include "/etc/bind/kubernetes-main.sops.key";
include "/etc/bind/kubernetes-utility.sops.key";

acl internal {
    10.0.0.0/8;
    172.16.0.0/12;
    192.168.0.0/16;
};

controls {
    inet * allow { internal; } keys { rndc-key; };
    inet 127.0.0.1 allow { 127.0.0.1; } keys { rndc-key; };
};

options {
    listen-on port 5301 { any; };
    directory "/var/cache/bind";
    allow-query { any; };
    allow-recursion { internal; };
    allow-update { none; };
    dnssec-validation no;
    notify yes;
    also-notify { 192.168.1.3 port 5301; };
    allow-transfer { 192.168.1.3; };
};

zone "jory.dev." {
    type primary;
    file "/etc/bind/zones/jory.dev.zone";
    journal "/var/cache/bind/jory.dev.zone.jnl";
    allow-query { any; };
    allow-transfer {
        key "kubernetes-main-key";
        192.168.1.3;
    };
    update-policy { grant kubernetes-main-key zonesub ANY; };
};

zone "j8g.dev." {
    type primary;
    file "/etc/bind/zones/j8g.dev.zone";
    journal "/var/cache/bind/j8g.dev.zone.jnl";
    allow-query { any; };
    allow-transfer {
        key "kubernetes-utility-key";
        192.168.1.3;
    };
    update-policy { grant kubernetes-utility-key zonesub ANY; };
};

zone "jory.casa." {
    type primary;
    file "/etc/bind/zones/jory.casa.zone";
    journal "/var/cache/bind/jory.casa.zone.jnl";
    allow-query { any; };
    allow-transfer {
        192.168.1.3;
    };
};
